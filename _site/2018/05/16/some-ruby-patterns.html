<!Doctype html>

<html><head>
    <meta charset="utf-8">
    <title>Victor's Site</title>
    <link rel="stylesheet" href="/css/main.css" >
    <link href="/css/syntax.css" rel="stylesheet">
</head>
<body><header>
    <h1>Victor Lymar</h1>
</header>


<main class="page-content">
            <div class="wrapper">
                <article>

    <header>
        <h1>Some Ruby Patterns</h1>
    </header>

    <div>
        <blockquote>
  <p>Then they come up to me and say, “I was surprised by this feature of the language, so therefore Ruby violates the principle of least surprise.” Wait. Wait. The principle of least surprise is not for you only. The principle of least surprise means principle of least my surprise. And it means the principle of least surprise after you learn Ruby very well.</p>
</blockquote>

<blockquote>
  <p>- Yukihiro Matsumoto (<a href="https://www.artima.com/intv/ruby4.html">https://www.artima.com/intv/ruby4.html</a>)</p>
</blockquote>

<p>Over 4 years of working with Ruby I’ve picked up a fair number of conventions, tricks and footguns. Here are a few I wish I knew when I was getting started.</p>

<hr />

<h3 id="or-equals-">Or-Equals (<code class="highlighter-rouge">||=</code>)</h3>
<p>Commonly used to assign a variable who’s current value is nil. Takes advantage of the fact that <code class="highlighter-rouge">nil</code> evaluates as <code class="highlighter-rouge">false</code> in Ruby.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">foo</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="n">foo</span> <span class="o">||=</span> <span class="mi">1</span>
<span class="n">foo</span> <span class="o">||=</span> <span class="mi">2</span> <span class="c1"># does not assign 2</span>
<span class="n">foo</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1">#=&gt; true</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Related: <code class="highlighter-rouge">&amp;&amp;=</code>.</p>

<h3 id="converting-symbols-to-procs">Converting symbols to procs</h3>
<p>One of the less immediately intuitive keywords in Ruby is <code class="highlighter-rouge">&amp;:symbol</code>, which is a shorthand for <code class="highlighter-rouge">Symbol#to_proc</code> (<a href="[https://ruby-doc.org/core-2.5.1/Symbol.html#method-i-to%5C_proc]">documentation</a>).</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_s</span><span class="p">)</span> <span class="c1">#=&gt; ["1", "2", "3"]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">select</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:even?</span><span class="p">)</span> <span class="c1">#=&gt; [2]</span>

<span class="c1"># equivalent to the above:</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">to_s</span> <span class="p">}</span> <span class="c1">#=&gt; ["1", "2", "3"]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">even?</span> <span class="p">}</span> <span class="c1">#=&gt; [2]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">Symbol#to_proc</code>  returns a <code class="highlighter-rouge">Proc</code> that accepts a single argument and then calls the method named by the symbol on that argument.</p>

<h3 id="bootstrapping-classes-with-struct">Bootstrapping classes with <code class="highlighter-rouge">Struct</code></h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1"># Variant 1</span>
<span class="no">Car</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:make</span><span class="p">,</span> <span class="ss">:model</span><span class="p">)</span>

<span class="c1"># Variant 2</span>
<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:birthdate</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">birth_year</span>
    <span class="vi">@birthdate</span><span class="p">.</span><span class="nf">year</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-vs-and--vs-or"><code class="highlighter-rouge">&amp;&amp;</code> vs <code class="highlighter-rouge">and</code>, <code class="highlighter-rouge">||</code> vs <code class="highlighter-rouge">or</code></h3>
<p>When I was mentoring interns at Scribd, a common issue was use of <code class="highlighter-rouge">and</code> and <code class="highlighter-rouge">or</code> (particularly with developers with Python backgrounds).
TODO</p>

<h3 id="class--self"><code class="highlighter-rouge">class &lt;&lt; self</code></h3>
<p>TODO: reopening class</p>

<h3><code class="highlighter-rouge">*</code></h3>
<p>TODO: array expansion</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">]</span> <span class="c1"># =&gt; [0, 1, 2]</span>
</pre></td></tr></tbody></table></code></pre></div></div>


    </div>

</article>

            </div>
        </main>
    </body>

</html>
